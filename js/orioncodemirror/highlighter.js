define(["orion/editor/mirror","orion/editor/eventTarget"],function(e,t){function n(t,n){this.model=t,this.codeMirror=n,this.modeApplier=new e.ModeApplier(t,n),this.initialize(t)}return n.prototype={initialize:function(e){var t=this;this.listener={onDestroy:function(e){t._onDestroy(e)},onHighlight:function(e){t.sendStyle(e)}},this.model.addEventListener("Destroy",this.listener.onDestroy),this.modeApplier.addEventListener("Highlight",this.listener.onHighlight)},destroy:function(){this.model&&this.model.removeEventListener("Destroy",this.listener.onDestroy),this.modeApplier&&(this.modeApplier.removeEventListener("Highlight",this.listener.onHighlight),this.modeApplier.destroy()),this.listener=null,this.model=null,this.codeMirror=null,this.modeApplier=null},setMode:function(e){this.modeApplier.setMode(e,!0)},setViewportIndex:function(e){},sendStyle:function(e){var t=e.start,n=e.end,r=this.modeApplier,i=r.getLineStyles();if(t<Number.MAX_VALUE&&n>-1){var s={};for(var o=t;o<=n;o++){var u=o,a=i[u],f=a&&r.toStyleRangesAndErrors(a);if(f){var l=f[0],c=f[1],h={},p=!1;l&&l.length&&(h.ranges=l,s[o]=h,p=!0),c&&c.length&&(h.errors=c,s[o]=h,p=!0),p||(s[o]=null)}}var d={type:"StyleReady",lineStyles:s};this.dispatchEvent(d)}}},t.EventTarget.addMixin(n.prototype),{Highlighter:n}});